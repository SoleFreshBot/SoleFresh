<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoleFresh - –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2><i class="fas fa-list-alt"></i> –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h2>
        
        <div id="loader" class="loader"></div>
        
        <div id="services">
            <div class="service">
                <h3><i class="fas fa-rocket"></i> –ü—Ä–µ–º–∏—É–º –¥–∏–∑–∞–π–Ω</h3>
                <p>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å 3D-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π</p>
                <button onclick="addToCart('–ü—Ä–µ–º–∏—É–º –¥–∏–∑–∞–π–Ω', 5000)">
                    <i class="fas fa-cart-plus"></i> –î–æ–±–∞–≤–∏—Ç—å (5000 —Ä—É–±)
                </button>
            </div>
            
            <div class="service">
                <h3><i class="fas fa-chart-line"></i> –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ</h3>
                <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</p>
                <button onclick="addToCart('–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ', 3000)">
                    <i class="fas fa-cart-plus"></i> –î–æ–±–∞–≤–∏—Ç—å (3000 —Ä—É–±)
                </button>
            </div>
            
            <div class="service">
                <h3><i class="fas fa-code"></i> –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞</h3>
                <p>–°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–æ–≤ –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ø–æ–¥ –∫–ª—é—á</p>
                <button onclick="addToCart('–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞', 10000)">
                    <i class="fas fa-cart-plus"></i> –î–æ–±–∞–≤–∏—Ç—å (10000 —Ä—É–±)
                </button>
            </div>
            
            <div class="service">
                <h3><i class="fas fa-headset"></i> –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</h3>
                <p>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ digital-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</p>
                <button onclick="addToCart('–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è', 2500)">
                    <i class="fas fa-cart-plus"></i> –î–æ–±–∞–≤–∏—Ç—å (2500 —Ä—É–±)
                </button>
            </div>
        </div>
        
        <div id="cart" onclick="viewCart()">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
        </div>
    </div>

    <script>
        let cart = [];
        let user_id = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        document.addEventListener('DOMContentLoaded', async () => {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                user_id = Telegram.WebApp.initDataUnsafe.user?.id;
                await loadCart();
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ –ë–î
        async function loadCart() {
            if (!user_id) return;
            
            showLoader();
            
            try {
                const response = await fetch(`https://your-api-domain.com/get_cart?user_id=${user_id}`);
                const data = await response.json();
                
                if (data.cart_data) {
                    cart = JSON.parse(data.cart_data);
                    updateCartCount();
                    showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:", e);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã', 'error');
            } finally {
                hideLoader();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≤ –ë–î
        async function saveCart() {
            if (!user_id) return;
            
            showLoader();
            
            try {
                const response = await fetch('https://your-api-domain.com/save_cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: user_id,
                        cart_data: JSON.stringify(cart)
                    })
                });
                
                const result = await response.json();
                if (result.status !== 'success') {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
                return true;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã:", e);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã', 'error');
                return false;
            } finally {
                hideLoader();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
        async function addToCart(name, price) {
            cart.push({name, price});
            updateCartCount();
            showNotification(`${name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`);
            await saveCart();
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã
        async function viewCart() {
            if (cart.length === 0) {
                showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!', 'warning');
                return;
            }
            
            let message = "üõí –í–∞—à –∑–∞–∫–∞–∑:\n\n";
            let total = 0;
            
            cart.forEach(item => {
                message += `‚ñ™Ô∏è ${item.name}: ${item.price} —Ä—É–±\n`;
                total += item.price;
            });
            
            message += `\nüíµ –ò—Ç–æ–≥–æ: ${total} —Ä—É–±`;
            
            if (window.Telegram && Telegram.WebApp) {
                try {
                    await saveCart();
                    Telegram.WebApp.sendData(JSON.stringify({
                        action: 'view_cart',
                        cart: cart,
                        total: total
                    }));
                } catch (e) {
                    showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                }
            } else {
                alert(message);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
        function updateCartCount() {
            document.getElementById('cart-count').innerText = cart.length;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'exclamation'}"></i>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.add('hide');
                    
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 2000);
            }, 100);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫
        function showLoader() {
            document.getElementById('loader').style.display = 'block';
            document.getElementById('services').style.opacity = '0.5';
        }

        // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫
        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('services').style.opacity = '1';
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', async () => {
            await saveCart();
        });
    </script>
</body>
</html>
